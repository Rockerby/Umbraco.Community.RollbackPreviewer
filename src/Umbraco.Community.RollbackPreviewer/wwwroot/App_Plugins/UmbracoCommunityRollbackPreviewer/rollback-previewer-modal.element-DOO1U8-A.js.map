{"version":3,"file":"rollback-previewer-modal.element-DOO1U8-A.js","sources":["../../../Client/src/umbraco/rollback/repository/rollback.server.data-source.ts","../../../Client/src/umbraco/rollback/repository/rollback.repository.ts","../../../Client/src/umbraco/rollback/modal/rollback-modal.element.ts","../../../Client/src/rollback-previewer/rollback-previewer-modal.styles.ts","../../../Client/src/rollback-previewer/rollback-previewer-iframe.element.ts","../../../Client/src/rollback-previewer/rollback-previewer-modal.element.ts"],"sourcesContent":["import type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\nimport { DocumentVersionService } from '@umbraco-cms/backoffice/external/backend-api';\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\n\n/**\n * A data source for the Rollback that fetches data from the server\n * @class UmbRollbackServerDataSource\n * @implements {RepositoryDetailDataSource}\n */\nexport class UmbRollbackServerDataSource {\n\t#host: UmbControllerHost;\n\n\t/**\n\t * Creates an instance of UmbRollbackServerDataSource.\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\n\t * @memberof UmbRollbackServerDataSource\n\t */\n\tconstructor(host: UmbControllerHost) {\n\t\tthis.#host = host;\n\t}\n\n\t/**\n\t * Get a list of versions for a document\n\t * @param id\n\t * @param culture\n\t * @returns {*}\n\t * @memberof UmbRollbackServerDataSource\n\t */\n\tgetVersionsByDocumentId(id: string, culture?: string) {\n\t\treturn tryExecute(this.#host, DocumentVersionService.getDocumentVersion({ query: { documentId: id, culture } }));\n\t}\n\n\t/**\n\t * Get a specific version by id\n\t * @param versionId\n\t * @returns {*}\n\t * @memberof UmbRollbackServerDataSource\n\t */\n\tgetVersionById(versionId: string) {\n\t\treturn tryExecute(this.#host, DocumentVersionService.getDocumentVersionById({ path: { id: versionId } }));\n\t}\n\n\tsetPreventCleanup(versionId: string, preventCleanup: boolean) {\n\t\treturn tryExecute(\n\t\t\tthis.#host,\n\t\t\tDocumentVersionService.putDocumentVersionByIdPreventCleanup({\n\t\t\t\tpath: { id: versionId },\n\t\t\t\tquery: { preventCleanup },\n\t\t\t}),\n\t\t);\n\t}\n\n\trollback(versionId: string, culture?: string) {\n\t\treturn tryExecute(\n\t\t\tthis.#host,\n\t\t\tDocumentVersionService.postDocumentVersionByIdRollback({ path: { id: versionId }, query: { culture } }),\n\t\t);\n\t}\n}","import { UmbRollbackServerDataSource } from './rollback.server.data-source.js';\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\n\nexport class UmbRollbackRepository extends UmbControllerBase implements UmbApi {\n\t#dataSource: UmbRollbackServerDataSource;\n\n\tconstructor(host: UmbControllerHost) {\n\t\tsuper(host);\n\n\t\tthis.#dataSource = new UmbRollbackServerDataSource(this);\n\t}\n\n\tasync requestVersionsByDocumentId(id: string, culture?: string) {\n\t\treturn await this.#dataSource.getVersionsByDocumentId(id, culture);\n\t}\n\n\tasync requestVersionById(id: string) {\n\t\treturn await this.#dataSource.getVersionById(id);\n\t}\n\n\tasync setPreventCleanup(versionId: string, preventCleanup: boolean) {\n\t\treturn await this.#dataSource.setPreventCleanup(versionId, preventCleanup);\n\t}\n\n\tasync rollback(versionId: string, culture?: string) {\n\t\treturn await this.#dataSource.rollback(versionId, culture);\n\t}\n}\n\nexport default UmbRollbackRepository;\n","/**\n * Developer Note:\n * This version of the default rollback modal as be slightly modified to support the our custom rollback previewer.\n * The main differences are:\n * - Converted a number of private properties and methods to public so they can be used in the custom rollback previewer. These are marked with a comment.\n * - Updated some imports to use @umbraco-cms/backoffice/document\n * - Improved version selector to make it more accessible (keyboard navigable & improved colour contrast)\n */\n\n// import { UMB_DOCUMENT_ENTITY_TYPE } from '../../constants.js';\n// import { UmbRollbackRepository } from '../repository/rollback.repository.js';\n// import { UmbDocumentDetailRepository } from '../../repository/index.js';\n// import type { UmbDocumentDetailModel } from '../../types.js';\n// import type { UmbRollbackModalData, UmbRollbackModalValue } from './types.js';\n// import { diffWords, type UmbDiffChange } from '@umbraco-cms/backoffice/utils';\n// import { css, customElement, html, nothing, repeat, state, unsafeHTML } from '@umbraco-cms/backoffice/external/lit';\n// import { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\n// import { UmbTextStyles } from '@umbraco-cms/backoffice/style';\n// import { UmbUserItemRepository } from '@umbraco-cms/backoffice/user';\n// import { UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\n// import type { UUISelectEvent } from '@umbraco-cms/backoffice/external/uui';\n// import { UMB_APP_LANGUAGE_CONTEXT, UmbLanguageItemRepository } from '@umbraco-cms/backoffice/language';\n// import { UMB_ENTITY_CONTEXT } from '@umbraco-cms/backoffice/entity';\n// import { UmbVariantId } from '@umbraco-cms/backoffice/variant';\n//\n// import '../../modals/shared/document-variant-language-picker.element.js';\n// import { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\n// import { UmbEntityUpdatedEvent, UmbRequestReloadStructureForEntityEvent } from '@umbraco-cms/backoffice/entity-action';\n\n\nimport { UMB_DOCUMENT_ENTITY_TYPE } from \"@umbraco-cms/backoffice/document\";\nimport { UmbRollbackRepository } from \"../repository/rollback.repository.js\";\nimport { UmbDocumentDetailRepository } from \"@umbraco-cms/backoffice/document\";\nimport type { UmbDocumentDetailModel } from \"@umbraco-cms/backoffice/document\";\nimport type { UmbRollbackModalData, UmbRollbackModalValue } from \"./types.js\";\nimport { diffWords, type UmbDiffChange } from '@umbraco-cms/backoffice/utils';\nimport { css, customElement, html, nothing, repeat, state, unsafeHTML } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport { UmbTextStyles } from \"@umbraco-cms/backoffice/style\";\nimport { UmbUserItemRepository } from \"@umbraco-cms/backoffice/user\";\nimport { UMB_PROPERTY_DATASET_CONTEXT } from \"@umbraco-cms/backoffice/property\";\nimport type { UUISelectEvent } from \"@umbraco-cms/backoffice/external/uui\";\nimport { UMB_APP_LANGUAGE_CONTEXT, UmbLanguageItemRepository } from \"@umbraco-cms/backoffice/language\";\nimport { UMB_ENTITY_CONTEXT } from \"@umbraco-cms/backoffice/entity\";\nimport { UmbVariantId } from \"@umbraco-cms/backoffice/variant\";\n// import \"../../modals/shared/document-variant-language-picker.element.js\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport { UmbEntityUpdatedEvent, UmbRequestReloadStructureForEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\n\n\n\n\n\n\n\ntype DocumentVersion = {\n\tid: string;\n\tdate: string;\n\tuser: string;\n\tisCurrentlyPublishedVersion: boolean;\n\tpreventCleanup: boolean;\n};\n\n@customElement('umb-rollback-modal')\nexport class UmbRollbackModalElement extends UmbModalBaseElement<UmbRollbackModalData, UmbRollbackModalValue> {\n\t@state()\n\t_versions: DocumentVersion[] = [];\n\n\t@state()\n\t_selectedVersion?: {\n\t\tdate: string;\n\t\tname: string;\n\t\tuser: string;\n\t\tid: string;\n\t\tproperties: {\n\t\t\talias: string;\n\t\t\tvalue: string;\n\t\t}[];\n\t};\n\n\t@state()\n\t_selectedCulture: string | null = null;\n\n\t@state()\n\t_isInvariant = true;\n\n\t@state()\n\t_availableVariants: Option[] = [];\n\n\t@state()\n\t_diffs: Array<{ alias: string; diff: UmbDiffChange[] }> = [];\n\n\t#rollbackRepository = new UmbRollbackRepository(this);\n\t#userItemRepository = new UmbUserItemRepository(this);\n\n\t#localizeDateOptions: Intl.DateTimeFormatOptions = {\n\t\tday: 'numeric',\n\t\tmonth: 'long',\n\t\thour: 'numeric',\n\t\tminute: '2-digit',\n\t};\n\n\t// Change Note - Converted to public method\n\tcurrentDocument: UmbDocumentDetailModel | undefined;\n\t#currentAppCulture: string | undefined;\n\t#currentDatasetCulture: string | undefined;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, (instance) => {\n\t\t\tthis.#currentDatasetCulture = instance?.getVariantId().culture ?? undefined;\n\t\t\tthis.#selectCulture();\n\t\t});\n\n\t\tthis.consumeContext(UMB_APP_LANGUAGE_CONTEXT, (instance) => {\n\t\t\tthis.#currentAppCulture = instance?.getAppCulture();\n\t\t\tthis.#selectCulture();\n\t\t});\n\n\t\tthis.consumeContext(UMB_ENTITY_CONTEXT, async (instance) => {\n\t\t\tif (!instance) return;\n\t\t\tif (instance.getEntityType() !== UMB_DOCUMENT_ENTITY_TYPE) {\n\t\t\t\tthrow new Error(`Entity type is not ${UMB_DOCUMENT_ENTITY_TYPE}`);\n\t\t\t}\n\n\t\t\tconst unique = instance.getUnique();\n\n\t\t\tif (!unique) {\n\t\t\t\tthrow new Error('Document unique is not set');\n\t\t\t}\n\n\t\t\tconst { data } = await new UmbDocumentDetailRepository(this).requestByUnique(unique);\n\t\t\tif (!data) return;\n\n\t\t\tthis.currentDocument = data;\n\t\t\tconst itemVariants = this.currentDocument?.variants ?? [];\n\n\t\t\tthis._isInvariant = itemVariants.length === 1 && new UmbVariantId(itemVariants[0].culture).isInvariant();\n\t\t\tthis.#selectCulture();\n\n\t\t\tconst cultures = itemVariants.map((x) => x.culture).filter((x) => x !== null) as string[];\n\t\t\tconst { data: languageItems } = await new UmbLanguageItemRepository(this).requestItems(cultures);\n\n\t\t\tif (languageItems) {\n\t\t\t\tthis._availableVariants = languageItems.map((language) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: language.name,\n\t\t\t\t\t\tvalue: language.unique,\n\t\t\t\t\t\tselected: language.unique === this._selectedCulture,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._availableVariants = [];\n\t\t\t}\n\n\t\t\tthis.#requestVersions();\n\t\t});\n\t}\n\n\t#selectCulture() {\n\t\tconst contextCulture = this.#currentDatasetCulture ?? this.#currentAppCulture ?? null;\n\t\tthis._selectedCulture = this._isInvariant ? null : contextCulture;\n\t}\n\n\tasync #requestVersions() {\n\t\tif (!this.currentDocument?.unique) {\n\t\t\tthrow new Error('Document unique is not set');\n\t\t}\n\n\t\tconst { data } = await this.#rollbackRepository.requestVersionsByDocumentId(\n\t\t\tthis.currentDocument?.unique,\n\t\t\tthis._selectedCulture ?? undefined,\n\t\t);\n\t\tif (!data) return;\n\n\t\tconst tempItems: DocumentVersion[] = [];\n\n\t\tconst uniqueUserIds = [...new Set(data?.items.map((item) => item.user.id))];\n\n\t\tconst { data: userItems } = await this.#userItemRepository.requestItems(uniqueUserIds);\n\n\t\tdata?.items.forEach((item: any) => {\n\t\t\tif (item.isCurrentDraftVersion) return;\n\n\t\t\ttempItems.push({\n\t\t\t\tdate: item.versionDate,\n\t\t\t\tuser:\n\t\t\t\t\tuserItems?.find((user) => user.unique === item.user.id)?.name || this.localize.term('general_unknownUser'),\n\t\t\t\tisCurrentlyPublishedVersion: item.isCurrentPublishedVersion,\n\t\t\t\tid: item.id,\n\t\t\t\tpreventCleanup: item.preventCleanup,\n\t\t\t});\n\t\t});\n\n\t\tthis._versions = tempItems;\n\t\tconst id = tempItems.find((item) => item.isCurrentlyPublishedVersion)?.id;\n\n\t\tif (id) {\n\t\t\tthis.#selectVersion(id);\n\t\t}\n\t}\n\n\tasync #selectVersion(id: string) {\n\t\tconst version = this._versions.find((item) => item.id === id);\n\n\t\tif (!version) {\n\t\t\tthis._selectedVersion = undefined;\n\t\t\tthis._diffs = [];\n\t\t\treturn;\n\t\t}\n\n\t\tconst { data } = await this.#rollbackRepository.requestVersionById(id);\n\n\t\tif (!data) {\n\t\t\tthis._selectedVersion = undefined;\n\t\t\tthis._diffs = [];\n\t\t\treturn;\n\t\t}\n\n\t\tthis._selectedVersion = {\n\t\t\tdate: version.date,\n\t\t\tuser: version.user,\n\t\t\tname: data.variants.find((x) => x.culture === this._selectedCulture)?.name || data.variants[0].name,\n\t\t\tid: data.id,\n\t\t\tproperties: data.values\n\t\t\t\t.filter((x) => x.culture === this._selectedCulture || !x.culture) // When invariant, culture is undefined or null.\n\t\t\t\t.map((value: any) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\talias: value.alias,\n\t\t\t\t\t\tvalue: value.value,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t};\n\n\t\tawait this.#setDiffs();\n\t}\n\n\tasync onRollback() {\n\t\tif (!this._selectedVersion) return;\n\n\t\tconst id = this._selectedVersion.id;\n\t\tconst culture = this._selectedCulture ?? undefined;\n\n\t\tconst { error } = await this.#rollbackRepository.rollback(id, culture);\n\t\tif (error) return;\n\n\t\tconst unique = this.currentDocument?.unique;\n\t\tconst entityType = this.currentDocument?.entityType;\n\n\t\tif (!unique || !entityType) {\n\t\t\tthrow new Error('Document unique or entity type is not set');\n\t\t}\n\n\t\tconst actionEventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n\t\tif (!actionEventContext) {\n\t\t\tthrow new Error('Action event context not found');\n\t\t}\n\n\t\tconst reloadStructureEvent = new UmbRequestReloadStructureForEntityEvent({ unique, entityType });\n\t\tactionEventContext.dispatchEvent(reloadStructureEvent);\n\n\t\tconst entityUpdatedEvent = new UmbEntityUpdatedEvent({ unique, entityType });\n\t\tactionEventContext.dispatchEvent(entityUpdatedEvent);\n\n\t\tthis.value = {};\n\n\t\tthis.modalContext?.submit();\n\t}\n\n\tonCancel() {\n\t\tthis.modalContext?.reject();\n\t}\n\n\t#onVersionClicked(id: string) {\n\t\tthis.#selectVersion(id);\n\t}\n\n\t#onPreventCleanup(event: Event, id: string, preventCleanup: boolean) {\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\t\tthis.#rollbackRepository.setPreventCleanup(id, preventCleanup);\n\n\t\tconst version = this._versions.find((item) => item.id === id);\n\t\tif (!version) return;\n\n\t\tversion.preventCleanup = preventCleanup;\n\t\tthis.requestUpdate('_versions');\n\t}\n\n\t#onChangeCulture(event: UUISelectEvent) {\n\t\tconst value = event.target.value;\n\n\t\tthis._selectedCulture = value.toString();\n\t\tthis.#requestVersions();\n\t}\n\n\t#trimQuotes(str: string): string {\n\t\treturn str.replace(/^['\"]|['\"]$/g, '');\n\t}\n\n\t// Change Note - Converted to public method\n\trenderCultureSelect() {\n\t\treturn html`\n\t\t\t<uui-select\n\t\t\t\tid=\"language-select\"\n\t\t\t\t@change=${this.#onChangeCulture}\n\t\t\t\t.options=${this._availableVariants}></uui-select>\n\t\t`;\n\t}\n\n\trenderVersions() {\n\t\tif (!this._versions.length) {\n\t\t\treturn html`<uui-box headline=${this.localize.term('rollback_versions')}>No versions available</uui-box>`;\n\t\t}\n\n\t\treturn html` <uui-box id=\"versions-box\" headline=${this.localize.term('rollback_versions')}>\n\t\t\t${repeat(\n\t\t\t\tthis._versions,\n\t\t\t\t(item) => item.id,\n\t\t\t\t(item) => {\n\t\t\t\t\treturn html`\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t@click=${() => this.#onVersionClicked(item.id)}\n\t\t\t\t\t\t\t@keydown=${() => {}}\n\t\t\t\t\t\t\tclass=\"rollback-item ${this._selectedVersion?.id === item.id ? 'active' : ''}\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"rollback-item-date\">\n\t\t\t\t\t\t\t\t\t<umb-localize-date date=\"${item.date}\" .options=${this.#localizeDateOptions}></umb-localize-date>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<p>${item.user}</p>\n\t\t\t\t\t\t\t\t<p>${item.isCurrentlyPublishedVersion ? this.localize.term('rollback_currentPublishedVersion') : ''}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<uui-button\n\t\t\t\t\t\t\t\tlook=\"secondary\"\n\t\t\t\t\t\t\t\t@click=${(event: Event) => this.#onPreventCleanup(event, item.id, !item.preventCleanup)}\n\t\t\t\t\t\t\t\tlabel=${item.preventCleanup\n\t\t\t\t\t\t\t\t\t? this.localize.term('contentTypeEditor_historyCleanupEnableCleanup')\n\t\t\t\t\t\t\t\t\t: this.localize.term('contentTypeEditor_historyCleanupPreventCleanup')}></uui-button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\t\t\t},\n\t\t\t)}</uui-box\n\t\t>`;\n\t}\n\n\tasync #setDiffs() {\n\t\tif (!this._selectedVersion) return;\n\n\t\tconst currentPropertyValues = this.currentDocument?.values.filter(\n\t\t\t(x) => x.culture === this._selectedCulture || !x.culture,\n\t\t); // When invariant, culture is undefined or null.\n\n\t\tif (!currentPropertyValues) {\n\t\t\tthrow new Error('Current property values are not set');\n\t\t}\n\n\t\tconst currentName = this.currentDocument?.variants.find((x) => x.culture === this._selectedCulture)?.name;\n\n\t\tif (!currentName) {\n\t\t\tthrow new Error('Current name is not set');\n\t\t}\n\n\t\tconst diffs: Array<{ alias: string; diff: UmbDiffChange[] }> = [];\n\n\t\tconst nameDiff = diffWords(currentName, this._selectedVersion.name);\n\t\tdiffs.push({ alias: 'name', diff: nameDiff });\n\n\t\tthis._selectedVersion.properties.forEach((item) => {\n\t\t\tconst draftValue = currentPropertyValues.find((x) => x.alias === item.alias);\n\n\t\t\tif (!draftValue) return;\n\n\t\t\tconst draftValueString = this.#trimQuotes(JSON.stringify(draftValue.value));\n\t\t\tconst versionValueString = this.#trimQuotes(JSON.stringify(item.value));\n\n\t\t\tconst diff = diffWords(draftValueString, versionValueString);\n\t\t\tdiffs.push({ alias: item.alias, diff });\n\t\t});\n\n\t\tthis._diffs = [...diffs];\n\t}\n\n\t// Change Note - Converted to public method\n\trenderSelectedVersion() {\n\t\tif (!this._selectedVersion)\n\t\t\treturn html`\n\t\t\t\t<uui-box id=\"box-right\" style=\"display: flex; align-items: center; justify-content: center;\"\n\t\t\t\t\t>No selected version</uui-box\n\t\t\t\t>\n\t\t\t`;\n\n\t\treturn html`\n\t\t\t<uui-box headline=${this.currentVersionHeader} id=\"box-right\">\n\t\t\t\t${unsafeHTML(this.localize.term('rollback_diffHelp'))}\n\t\t\t\t<uui-table>\n\t\t\t\t\t<uui-table-column style=\"width: 0\"></uui-table-column>\n\t\t\t\t\t<uui-table-column></uui-table-column>\n\n\t\t\t\t\t<uui-table-head>\n\t\t\t\t\t\t<uui-table-head-cell>${this.localize.term('general_alias')}</uui-table-head-cell>\n\t\t\t\t\t\t<uui-table-head-cell>${this.localize.term('general_value')}</uui-table-head-cell>\n\t\t\t\t\t</uui-table-head>\n\t\t\t\t\t${repeat(\n\t\t\t\t\t\tthis._diffs,\n\t\t\t\t\t\t(item) => item.alias,\n\t\t\t\t\t\t(item) => {\n\t\t\t\t\t\t\tconst diff = this._diffs.find((x) => x?.alias === item.alias);\n\t\t\t\t\t\t\treturn html`\n\t\t\t\t\t\t\t\t<uui-table-row>\n\t\t\t\t\t\t\t\t\t<uui-table-cell>${item.alias}</uui-table-cell>\n\t\t\t\t\t\t\t\t\t<uui-table-cell>\n\t\t\t\t\t\t\t\t\t\t${diff\n\t\t\t\t\t\t\t\t\t\t\t? diff.diff.map((part) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tpart.added\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? html`<span class=\"diff-added\">${part.value}</span>`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: part.removed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? html`<span class=\"diff-removed\">${part.value}</span>`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: part.value,\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t: nothing}\n\t\t\t\t\t\t\t\t\t</uui-table-cell>\n\t\t\t\t\t\t\t\t</uui-table-row>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t},\n\t\t\t\t\t)}\n\t\t\t\t</uui-table>\n\t\t\t</uui-box>\n\t\t`;\n\t}\n\n\tget currentVersionHeader() {\n\t\treturn (\n\t\t\tthis.localize.date(this._selectedVersion?.date ?? new Date(), this.#localizeDateOptions) +\n\t\t\t' - ' +\n\t\t\tthis._selectedVersion?.user\n\t\t);\n\t}\n\n\toverride render() {\n\t\treturn html`\n\t\t\t<umb-body-layout headline=\"Rollback\">\n\t\t\t\t<div id=\"main\">\n\t\t\t\t\t<div id=\"box-left\">\n\t\t\t\t\t\t${this._availableVariants.length\n\t\t\t\t\t\t\t? html`\n\t\t\t\t\t\t\t\t\t<uui-box id=\"language-box\" headline=${this.localize.term('general_language')}>\n\t\t\t\t\t\t\t\t\t\t${this.renderCultureSelect()}\n\t\t\t\t\t\t\t\t\t</uui-box>\n\t\t\t\t\t\t\t\t`\n\t\t\t\t\t\t\t: nothing}\n\t\t\t\t\t\t${this.renderVersions()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.renderSelectedVersion()}\n\t\t\t\t</div>\n\t\t\t\t<umb-footer-layout slot=\"footer\">\n\t\t\t\t\t<uui-button\n\t\t\t\t\t\tslot=\"actions\"\n\t\t\t\t\t\tlook=\"secondary\"\n\t\t\t\t\t\t@click=${this.onCancel}\n\t\t\t\t\t\tlabel=${this.localize.term('general_cancel')}></uui-button>\n\t\t\t\t\t<uui-button\n\t\t\t\t\t\tslot=\"actions\"\n\t\t\t\t\t\tlook=\"primary\"\n\t\t\t\t\t\t@click=${this.onRollback}\n\t\t\t\t\t\tlabel=${this.localize.term('actions_rollback')}\n\t\t\t\t\t\t?disabled=${!this._selectedVersion}></uui-button>\n\t\t\t\t</umb-footer-layout>\n\t\t\t</umb-body-layout>\n\t\t`;\n\t}\n\n\tstatic override styles = [\n\t\tUmbTextStyles,\n\t\tcss`\n\t\t\t:host {\n\t\t\t\tcolor: var(--uui-color-text);\n\t\t\t}\n\n\t\t\t#language-box {\n\t\t\t\tmargin-bottom: var(--uui-size-space-2);\n\t\t\t}\n\n\t\t\t#language-select {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\n\t\t\tuui-table {\n\t\t\t\t--uui-table-cell-padding: var(--uui-size-space-1) var(--uui-size-space-4);\n\t\t\t\tmargin-top: var(--uui-size-space-5);\n\t\t\t}\n\t\t\tuui-table-head-cell:first-child {\n\t\t\t\tborder-top-left-radius: var(--uui-border-radius);\n\t\t\t}\n\t\t\tuui-table-head-cell:last-child {\n\t\t\t\tborder-top-right-radius: var(--uui-border-radius);\n\t\t\t}\n\t\t\tuui-table-head-cell {\n\t\t\t\tbackground-color: var(--uui-color-surface-alt);\n\t\t\t}\n\t\t\tuui-table-head-cell:last-child,\n\t\t\tuui-table-cell:last-child {\n\t\t\t\tborder-right: 1px solid var(--uui-color-border);\n\t\t\t}\n\t\t\tuui-table-head-cell,\n\t\t\tuui-table-cell {\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\n\t\t\t\tborder-left: 1px solid var(--uui-color-border);\n\t\t\t}\n\t\t\tuui-table-row:last-child uui-table-cell {\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\n\t\t\t}\n\t\t\tuui-table-row:last-child uui-table-cell:last-child {\n\t\t\t\tborder-bottom-right-radius: var(--uui-border-radius);\n\t\t\t}\n\t\t\tuui-table-row:last-child uui-table-cell:first-child {\n\t\t\t\tborder-bottom-left-radius: var(--uui-border-radius);\n\t\t\t}\n\n\t\t\t.diff-added,\n\t\t\tins {\n\t\t\t\tbackground-color: #00c43e63;\n\t\t\t}\n\t\t\t.diff-removed,\n\t\t\tdel {\n\t\t\t\tbackground-color: #ff35356a;\n\t\t\t}\n\t\t\t.rollback-item {\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: var(--uui-size-space-5);\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\t\t\t.rollback-item::after {\n\t\t\t\tcontent: '';\n\t\t\t\tposition: absolute;\n\t\t\t\tinset: 2px;\n\t\t\t\tdisplay: block;\n\t\t\t\tborder: 2px solid transparent;\n\t\t\t\tpointer-events: none;\n\t\t\t}\n\t\t\t.rollback-item.active::after,\n\t\t\t.rollback-item:hover::after {\n\t\t\t\tborder-color: var(--uui-color-selected);\n\t\t\t}\n\t\t\t.rollback-item:not(.active):hover::after {\n\t\t\t\topacity: 0.5;\n\t\t\t}\n\t\t\t.rollback-item p {\n\t\t\t\tmargin: 0;\n\t\t\t\topacity: 0.5;\n\t\t\t}\n\t\t\tp.rollback-item-date {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t\t.rollback-item uui-button {\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\n\t\t\t#main {\n\t\t\t\tdisplay: flex;\n\t\t\t\tgap: var(--uui-size-space-5);\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t}\n\n\t\t\t#versions-box {\n\t\t\t\t--uui-box-default-padding: 0;\n\t\t\t}\n\n\t\t\t#box-left {\n\t\t\t\tmax-width: 500px;\n\t\t\t\tflex: 1;\n\t\t\t\toverflow: auto;\n\t\t\t\theight: 100%;\n\t\t\t}\n\n\t\t\t#box-right {\n\t\t\t\tflex: 1;\n\t\t\t\toverflow: auto;\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t`,\n\t];\n}\n\nexport default UmbRollbackModalElement;\n\ndeclare global {\n\tinterface HTMLElementTagNameMap {\n\t\t'umb-rollback-modal': UmbRollbackModalElement;\n\t}\n}\n","import { css } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbRollbackModalElement } from \"../umbraco/rollback/modal/rollback-modal.element\";\n\nexport const rpRollbackStyles = [\n  ...UmbRollbackModalElement.styles, // Importing the base styles from UmbRollbackModalElement\n  css`\n    .preview-view {\n      #main {\n        display: grid;\n        place-content: start;\n        grid-template-columns: 1fr;\n        gap: var(--uui-size-space-5);\n        height: 100%;\n        container-type: inline-size;\n      }\n\n      #box-left {\n        max-height: 300px;\n        max-width: 100%;\n      }\n\n      #box-right {\n        width: 100cqw;\n      }\n    }\n\n    .rp-wrapper {\n      display: grid;\n      grid-template: \"current selected\" / 1fr 1fr;\n      gap: var(--uui-size-space-5);\n    }\n\n    .rp-container {\n      display: grid;\n      grid-template-columns: 1fr;\n      grid-template-rows: 1fr auto;\n      overflow: hidden;\n      container-type: inline-size;\n\n      .uui-h4 {\n        margin: 0;\n      }\n\n      .uui-text {\n        margin-top: 0.3rem;\n      }\n\n      &.current {\n        grid-area: current;\n      }\n\n      &.selected {\n        grid-area: selected;\n      }\n    }\n  `,\n];\n","import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  state,\n  query\n} from \"@umbraco-cms/backoffice/external/lit\";\n\nexport interface RollbackPreviewDevice {\n  alias: string;\n  label: string;\n  demensions: {\n    width: number;\n    height: number;\n  };\n}\n\nconst device: RollbackPreviewDevice = {\n  alias: \"desktop\",\n  label: \"Desktop\",\n  demensions: {\n    width: 1920,\n    height: 1080,\n  },\n};\n\n@customElement(\"rp-iframe\")\nexport class RpIframe extends LitElement {\n  @property({ type: String })\n  public src = \"\";\n\n  @state()\n  _device: RollbackPreviewDevice = device;\n\n  @query(\"iframe\")\n  iframe: HTMLIFrameElement | null | undefined;\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.src) {\n      console.error(\"No src provided for rollback previewer iframe\");\n    }\n\n    const resizeObserver = new ResizeObserver(() => {\n      this.updateIframeDevice();\n    });\n    resizeObserver.observe(this);\n  }\n\n  updateIframeDevice() {\n    let scale = this.clientWidth / this._device.demensions.width;\n\n    if (scale > 1) {\n      scale = 1;\n    }\n\n    this.style.setProperty(\"--rp-device-width\", `${this._device.demensions.width}px`);\n    this.style.setProperty(\"--rp-device-height\", `${this._device.demensions.height}px`);\n    this.style.setProperty(\"--rp-iframe-scale\", `${scale}`);\n    this.style.setProperty(\"--rp-height\", `${this._device.demensions.height * scale}px`);\n  }\n\n  resetScrollPosition() {\n    this.setScrollPosition(0, 0);\n  }\n\n  setScrollPosition(positionY: number = 0, positionX: number = 0) {\n    this.iframe?.contentWindow?.scrollTo({\n      top: positionY,\n      left: positionX,\n      behavior: 'instant'\n    });\n  }\n\n  async copyUrlToClipboard() {\n    if (!this.src) return;\n\n    const urlWithSecret = `${this.src}&secret=`;\n\n    try {\n      await navigator.clipboard.writeText(urlWithSecret);\n      // Could add a toast notification here if desired\n    } catch (err) {\n      console.error('Failed to copy URL to clipboard:', err);\n    }\n  }\n\n  // This is a LitElement specific method that is called when the element is first rendered\n  firstUpdated(): void {\n    this.updateIframeDevice();\n  }\n\n  override render() {\n    if (!this.src) {\n      return null;\n    }\n\n    return html`\n      <div id=\"wrapper\">\n          <button\n            id=\"copy-url-btn\"\n            @click=${this.copyUrlToClipboard}\n            title=\"Copy shareable preview URL to clipboard\"\n            aria-label=\"Copy shareable preview URL to clipboard\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\n              <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\n            </svg>\n          </button>\n          <iframe src=${this.src}></iframe>\n      </div>\n    `;\n  }\n\n  static override styles = [\n    css`\n      :host {\n        display: block;\n        height: var(--rp-height, auto);\n        width: 100cqw;\n      }\n\n      #wrapper {\n        width: var(--rp-device-width, 100%);\n        height: var(--rp-device-height, 600px);\n        transform: scale(var(--rp-iframe-scale, 1));\n        transform-origin: 0 0;\n        overflow: hidden;\n        position: relative;\n      }\n\n      #copy-url-btn {\n        position: absolute;\n        top: 8px;\n        right: 8px;\n        z-index: 1000;\n        background-color: #6b7280;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        padding: 8px 12px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n        font-size: 14px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        transition: background-color 0.2s ease;\n      }\n\n      #copy-url-btn:hover {\n        background-color: #4b5563;\n      }\n\n      #copy-url-btn:active {\n        background-color: #374151;\n      }\n\n      #copy-url-btn svg {\n        flex-shrink: 0;\n      }\n\n      iframe {\n        border: none;\n        inset: 0;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"rp-iframe\": RpIframe;\n  }\n}\n\nexport { RpIframe as default };\n","import {\n  customElement,\n  html,\n  nothing,\n  query,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport UmbRollbackModalElement from \"../umbraco/rollback/modal/rollback-modal.element.js\";\nimport { rpRollbackStyles } from \"./rollback-previewer-modal.styles.js\";\nimport \"./rollback-previewer-iframe.element.js\";\nimport RpIframe from \"./rollback-previewer-iframe.element.js\";\n\n@customElement(\"rp-rollback-modal\")\nexport class RpRollbackModalElement extends UmbRollbackModalElement {\n  #useJsonView: boolean = false;\n  #serverUrl: string = \"\";\n\n  @query(\"#rollbackPreviewerLeft\")\n  rollbackPreviewerLeft: RpIframe | null | undefined;\n\n  @query(\"#rollbackPreviewerRight\")\n  rollbackPreviewerRight: RpIframe | null | undefined;\n\n  constructor() {\n    super();\n    this.#init();\n  }\n\n  async #init() {\n    // This is how the server URL is fetched in the Umbraco codebase. See below for ref:\n    // https://github.com/umbraco/Umbraco-CMS/blob/fb0f719c7df9da96c514f1ed5bafd511e7218d5a/src/Umbraco.Web.UI.Client/src/apps/app/app.element.ts\n    this.#serverUrl = window.location.origin;\n  }\n\n  async #switchView() {\n    this.#useJsonView = !this.#useJsonView;\n    this.requestUpdate();\n\n    if (!this.#useJsonView) {\n      await this.updateComplete;\n      setTimeout(() => {\n        this.#setupScrollSync();\n    }, 300);\n    }\n  }\n\n  #setupScrollSync() {\n    if (!this.rollbackPreviewerLeft || !this.rollbackPreviewerRight) return;\n\n    const iframes = [this.rollbackPreviewerLeft, this.rollbackPreviewerRight];\n\n    iframes.forEach((iframe) => {\n      if (iframe === null) return;\n\n      iframe.onload = () => {\n        iframe.resetScrollPosition();\n      };\n    });\n\n    const handleScroll = (e: Event) => {\n      const scrolledWindow = e.currentTarget as Window;\n      const scrolledIframe = scrolledWindow?.frameElement as HTMLIFrameElement;\n      const otherIframes = iframes.filter(\n        (item) => item.iframe !== scrolledIframe\n      ).map(item => item.iframe);\n\n      if (!scrolledIframe) return;\n\n      otherIframes.forEach((otherIframe) => {\n        if (!otherIframe) return;\n        otherIframe.contentWindow?.removeEventListener(\n          \"scroll\",\n          handleScroll\n        );\n\n        this.#syncScroll(scrolledIframe, otherIframe);\n\n        window.requestAnimationFrame(() => {\n          otherIframe?.contentWindow?.addEventListener(\n            \"scroll\",\n            handleScroll\n          );\n        });\n      });\n    };\n\n    iframes.forEach((iframe) => {\n      iframe.iframe?.contentWindow?.addEventListener(\"scroll\", handleScroll);\n    });\n  }\n\n  #syncScroll(\n    scrolledIframe: HTMLIFrameElement,\n    targetIframe: HTMLIFrameElement\n  ) {\n    if (!scrolledIframe || !targetIframe) return;\n\n    try {\n      const scrolledDoc =\n        scrolledIframe.contentDocument ||\n        scrolledIframe.contentWindow?.document;\n      const targetDoc =\n        targetIframe.contentDocument ||\n        targetIframe.contentWindow?.document;\n\n      if (!scrolledDoc || !targetDoc) return;\n\n      // Calculate vertical scroll percentage\n      const scrolledEle = scrolledDoc.documentElement || scrolledDoc.body;\n      const targetEle = targetDoc.documentElement || targetDoc.body;\n\n      const maxScrollTop = scrolledEle.scrollHeight - scrolledEle.clientHeight;\n      const scrolledPercent =\n        maxScrollTop > 0 ? scrolledEle.scrollTop / maxScrollTop : 0;\n\n      const targetMaxScrollTop =\n        targetEle.scrollHeight - targetEle.clientHeight;\n      const targetTop = scrolledPercent * targetMaxScrollTop;\n\n      // Calculate horizontal scroll percentage if needed\n      const maxScrollLeft = scrolledEle.scrollWidth - scrolledEle.clientWidth;\n      const scrolledWidthPercent =\n        maxScrollLeft > 0 ? scrolledEle.scrollLeft / maxScrollLeft : 0;\n\n      const targetMaxScrollLeft = targetEle.scrollWidth - targetEle.clientWidth;\n      const targetLeft = scrolledWidthPercent * targetMaxScrollLeft;\n\n      // Apply scroll to target iframe\n      targetIframe.contentWindow?.scrollTo({\n        top: targetTop,\n        left: targetLeft,\n        behavior: \"instant\",\n      });\n    } catch (e) {\n      console.error(\"Error syncing scroll:\", e);\n    }\n  }\n\n  // This is a LitElement specific method that is called when the element is first rendered\n  updated(): void {\n    // This is a hack for now to wait for the iframe to load before setting up the scroll sync\n    setTimeout(() => {\n      this.#setupScrollSync();\n    }, 300);\n  }\n\n  renderSelectedVersionVisualPreview() {\n    if (!this._selectedVersion)\n      return html`\n        <uui-box\n          style=\"display: flex; align-items: center; justify-content: center;\"\n          >No selected version</uui-box\n        >\n      `;\n\n    return html`\n      <uui-box id=\"box-right\">\n        <div class=\"rp-wrapper\">\n          <div class=\"rp-container current\">\n            <div>\n              <h4 class=\"uui-h4\">Current version</h4>\n            </div>\n            <rp-iframe\n              id=\"rollbackPreviewerLeft\"\n              src=\"${this.#serverUrl}/${this.currentDocument\n                ?.unique}?culture=${this._selectedCulture}\"\n            >\n            </rp-iframe>\n          </div>\n          <div class=\"rp-container selected\">\n            <div>\n              <h4 class=\"uui-h4\">Selected version</h4>\n              <p class=\"uui-text\">${this.currentVersionHeader}</p>\n            </div>\n            <rp-iframe\n              id=\"rollbackPreviewerRight\"\n              src=\"${this.#serverUrl}/ucrbp?cid=${this.currentDocument\n                ?.unique}&vid=${this._selectedVersion.id}&culture=${this\n                ._selectedCulture}\"\n            ></rp-iframe>\n          </div>\n        </div>\n      </uui-box>\n    `;\n  }\n\n  override render() {\n    return html`\n      <umb-body-layout\n        headline=\"Visual Rollback Preview\"\n        class=${this.#useJsonView ? \"json-view\" : \"preview-view\"}\n      >\n        <uui-button\n          slot=\"action-menu\"\n          look=\"secondary\"\n          @click=${this.#switchView}\n          style=\"margin-right:24px\"\n          label=${this.#useJsonView ? \"Visual difference\" : \"JSON difference\"}\n        >\n          <uui-icon name=\"icon-repeat\" style=\"margin-right:4px\"></uui-icon>\n          ${this.#useJsonView\n            ? \"Visual difference\"\n            : \"JSON difference\"}</uui-button\n        >\n\n        <div id=\"main\">\n          <div id=\"box-left\">\n            ${this._availableVariants.length\n              ? html`\n                  <uui-box\n                    id=\"language-box\"\n                    headline=${this.localize.term(\"general_language\")}\n                  >\n                    ${this.renderCultureSelect()}\n                  </uui-box>\n                `\n              : nothing}\n            ${this.renderVersions()}\n          </div>\n          <div id=\"box-right\">\n            ${this.#useJsonView\n              ? html` ${this.renderSelectedVersion()} `\n              : html` ${this.renderSelectedVersionVisualPreview()} `}\n          </div>\n        </div>\n        <umb-footer-layout slot=\"footer\">\n          <uui-button\n            slot=\"actions\"\n            look=\"secondary\"\n            @click=${this.onCancel}\n            label=${this.localize.term(\"general_cancel\")}\n          ></uui-button>\n          <uui-button\n            slot=\"actions\"\n            look=\"primary\"\n            @click=${this.onRollback}\n            label=${this.localize.term(\"actions_rollback\")}\n            ?disabled=${!this._selectedVersion}\n          ></uui-button>\n        </umb-footer-layout>\n      </umb-body-layout>\n    `;\n  }\n\n  static override styles = rpRollbackStyles;\n}\n\nexport default RpRollbackModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"rp-rollback-modal\": RpRollbackModalElement;\n  }\n}\n"],"names":["UmbRollbackServerDataSource","host","__privateAdd","_host","__privateSet","id","culture","tryExecute","__privateGet","DocumentVersionService","versionId","preventCleanup","UmbRollbackRepository","UmbControllerBase","_dataSource","_rollbackRepository","_userItemRepository","_localizeDateOptions","_currentAppCulture","_currentDatasetCulture","_UmbRollbackModalElement_instances","selectCulture_fn","requestVersions_fn","selectVersion_fn","onVersionClicked_fn","onPreventCleanup_fn","onChangeCulture_fn","trimQuotes_fn","setDiffs_fn","UmbRollbackModalElement","UmbModalBaseElement","UmbUserItemRepository","UMB_PROPERTY_DATASET_CONTEXT","instance","__privateMethod","UMB_APP_LANGUAGE_CONTEXT","UMB_ENTITY_CONTEXT","UMB_DOCUMENT_ENTITY_TYPE","unique","data","UmbDocumentDetailRepository","itemVariants","_a","UmbVariantId","cultures","x","languageItems","UmbLanguageItemRepository","language","error","entityType","_b","actionEventContext","UMB_ACTION_EVENT_CONTEXT","reloadStructureEvent","UmbRequestReloadStructureForEntityEvent","entityUpdatedEvent","UmbEntityUpdatedEvent","_c","html","repeat","item","event","unsafeHTML","diff","part","nothing","contextCulture","tempItems","uniqueUserIds","userItems","user","version","value","str","currentPropertyValues","currentName","diffs","nameDiff","diffWords","draftValue","draftValueString","versionValueString","UmbTextStyles","css","__decorateClass","state","customElement","rpRollbackStyles","device","RpIframe","LitElement","scale","positionY","positionX","urlWithSecret","err","property","query","_useJsonView","_serverUrl","_RpRollbackModalElement_instances","init_fn","switchView_fn","setupScrollSync_fn","syncScroll_fn","RpRollbackModalElement","iframes","iframe","handleScroll","e","scrolledWindow","scrolledIframe","otherIframes","otherIframe","targetIframe","scrolledDoc","targetDoc","scrolledEle","targetEle","maxScrollTop","scrolledPercent","targetMaxScrollTop","targetTop","maxScrollLeft","scrolledWidthPercent","targetMaxScrollLeft","targetLeft","RpRollbackModalElement$1"],"mappings":";;;;;;;;;;;;;;;;;;;;;AASO,MAAMA,GAA4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQxC,YAAYC,GAAyB;AAPrC,IAAAC,EAAA,MAAAC;AAQC,IAAAC,EAAA,MAAKD,GAAQF;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUd,wBAAwBI,GAAYC,GAAkB;AACrD,WAAOC,EAAWC,EAAA,MAAKL,IAAOM,EAAuB,mBAAmB,EAAE,OAAO,EAAE,YAAYJ,GAAI,SAAAC,EAAQ,EAAG,CAAA,CAAC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShH,eAAeI,GAAmB;AACjC,WAAOH,EAAWC,EAAA,MAAKL,IAAOM,EAAuB,uBAAuB,EAAE,MAAM,EAAE,IAAIC,EAAA,EAAa,CAAA,CAAC;AAAA,EAAA;AAAA,EAGzG,kBAAkBA,GAAmBC,GAAyB;AACtD,WAAAJ;AAAA,MACNC,EAAA,MAAKL;AAAA,MACLM,EAAuB,qCAAqC;AAAA,QAC3D,MAAM,EAAE,IAAIC,EAAU;AAAA,QACtB,OAAO,EAAE,gBAAAC,EAAe;AAAA,MACxB,CAAA;AAAA,IACF;AAAA,EAAA;AAAA,EAGD,SAASD,GAAmBJ,GAAkB;AACtC,WAAAC;AAAA,MACNC,EAAA,MAAKL;AAAA,MACLM,EAAuB,gCAAgC,EAAE,MAAM,EAAE,IAAIC,KAAa,OAAO,EAAE,SAAAJ,IAAW,CAAA;AAAA,IACvG;AAAA,EAAA;AAEF;AAhDCH,IAAA;;ACLM,MAAMS,WAA8BC,GAAoC;AAAA,EAG9E,YAAYZ,GAAyB;AACpC,UAAMA,CAAI;AAHX,IAAAC,EAAA,MAAAY;AAKM,IAAAV,EAAA,MAAAU,GAAc,IAAId,GAA4B,IAAI;AAAA,EAAA;AAAA,EAGxD,MAAM,4BAA4BK,GAAYC,GAAkB;AAC/D,WAAO,MAAME,EAAA,MAAKM,GAAY,wBAAwBT,GAAIC,CAAO;AAAA,EAAA;AAAA,EAGlE,MAAM,mBAAmBD,GAAY;AACpC,WAAO,MAAMG,EAAA,MAAKM,GAAY,eAAeT,CAAE;AAAA,EAAA;AAAA,EAGhD,MAAM,kBAAkBK,GAAmBC,GAAyB;AACnE,WAAO,MAAMH,EAAA,MAAKM,GAAY,kBAAkBJ,GAAWC,CAAc;AAAA,EAAA;AAAA,EAG1E,MAAM,SAASD,GAAmBJ,GAAkB;AACnD,WAAO,MAAME,EAAA,MAAKM,GAAY,SAASJ,GAAWJ,CAAO;AAAA,EAAA;AAE3D;AAvBCQ,IAAA;;;;;;;2YCNDC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,IAAAC,IAAAC,IAAAC,GAAAC;AAgEa,IAAAC,IAAN,cAAsCC,GAAiE;AAAA,EA2C7G,cAAc;AACP,UAAA,GA5CD5B,EAAA,MAAAkB,CAAA,GAEN,KAAA,YAA+B,CAAC,GAeE,KAAA,mBAAA,MAGnB,KAAA,eAAA,IAGf,KAAA,qBAA+B,CAAC,GAGhC,KAAA,SAA0D,CAAC,GAErClB,EAAA,MAAAa,GAAA,IAAIH,GAAsB,IAAI,CAAA,GAC9BV,EAAA,MAAAc,GAAA,IAAIe,GAAsB,IAAI,CAAA,GAED7B,EAAA,MAAAe,GAAA;AAAA,MAClD,KAAK;AAAA,MACL,OAAO;AAAA,MACP,MAAM;AAAA,MACN,QAAQ;AAAA,IAAA,CACT,GAIAf,EAAA,MAAAgB,CAAA,GACAhB,EAAA,MAAAiB,CAAA,GAKM,KAAA,eAAea,IAA8B,CAACC,MAAa;AAC/D7B,MAAAA,GAAA,MAAKe,IAAyBc,KAAA,gBAAAA,EAAU,eAAe,YAAW,MAAA,GAClEC,EAAA,MAAKd,GAALC,CAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACA,GAEI,KAAA,eAAec,IAA0B,CAACF,MAAa;AACtD7B,MAAAA,GAAA,MAAAc,GAAqBe,KAAA,gBAAAA,EAAU,eAAc,GAClDC,EAAA,MAAKd,GAALC,CAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACA,GAEI,KAAA,eAAee,IAAoB,OAAOH,MAAa;;AAC3D,UAAI,CAACA,EAAU;AACX,UAAAA,EAAS,cAAc,MAAMI;AAChC,cAAM,IAAI,MAAM,sBAAsBA,EAAwB,EAAE;AAG3D,YAAAC,IAASL,EAAS,UAAU;AAElC,UAAI,CAACK;AACE,cAAA,IAAI,MAAM,4BAA4B;AAGvC,YAAA,EAAE,MAAAC,MAAS,MAAM,IAAIC,GAA4B,IAAI,EAAE,gBAAgBF,CAAM;AACnF,UAAI,CAACC,EAAM;AAEX,WAAK,kBAAkBA;AACvB,YAAME,MAAeC,IAAA,KAAK,oBAAL,gBAAAA,EAAsB,aAAY,CAAC;AAEnD,WAAA,eAAeD,EAAa,WAAW,KAAK,IAAIE,GAAaF,EAAa,CAAC,EAAE,OAAO,EAAE,YAAY,GACvGP,EAAA,MAAKd,GAALC,CAAA,EAAA,KAAA,IAAA;AAEA,YAAMuB,IAAWH,EAAa,IAAI,CAACI,MAAMA,EAAE,OAAO,EAAE,OAAO,CAACA,MAAMA,MAAM,IAAI,GACtE,EAAE,MAAMC,MAAkB,MAAM,IAAIC,GAA0B,IAAI,EAAE,aAAaH,CAAQ;AAE/F,MAAIE,IACH,KAAK,qBAAqBA,EAAc,IAAI,CAACE,OACrC;AAAA,QACN,MAAMA,EAAS;AAAA,QACf,OAAOA,EAAS;AAAA,QAChB,UAAUA,EAAS,WAAW,KAAK;AAAA,MACpC,EACA,IAED,KAAK,qBAAqB,CAAC,GAG5Bd,EAAA,MAAKd,GAALE,CAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACA;AAAA,EAAA;AAAA,EAiFF,MAAM,aAAa;;AACd,QAAA,CAAC,KAAK,iBAAkB;AAEtB,UAAAjB,IAAK,KAAK,iBAAiB,IAC3BC,IAAU,KAAK,oBAAoB,QAEnC,EAAE,OAAA2C,MAAU,MAAMzC,QAAKO,CAAoB,EAAA,SAASV,GAAIC,CAAO;AACrE,QAAI2C,EAAO;AAEL,UAAAX,KAASI,IAAA,KAAK,oBAAL,gBAAAA,EAAsB,QAC/BQ,KAAaC,IAAA,KAAK,oBAAL,gBAAAA,EAAsB;AAErC,QAAA,CAACb,KAAU,CAACY;AACT,YAAA,IAAI,MAAM,2CAA2C;AAG5D,UAAME,IAAqB,MAAM,KAAK,WAAWC,EAAwB;AACzE,QAAI,CAACD;AACE,YAAA,IAAI,MAAM,gCAAgC;AAGjD,UAAME,IAAuB,IAAIC,GAAwC,EAAE,QAAAjB,GAAQ,YAAAY,GAAY;AAC/F,IAAAE,EAAmB,cAAcE,CAAoB;AAErD,UAAME,IAAqB,IAAIC,GAAsB,EAAE,QAAAnB,GAAQ,YAAAY,GAAY;AAC3E,IAAAE,EAAmB,cAAcI,CAAkB,GAEnD,KAAK,QAAQ,CAAC,IAEdE,IAAA,KAAK,iBAAL,QAAAA,EAAmB;AAAA,EAAO;AAAA,EAG3B,WAAW;;AACV,KAAAhB,IAAA,KAAK,iBAAL,QAAAA,EAAmB;AAAA,EAAO;AAAA;AAAA,EA+B3B,sBAAsB;AACd,WAAAiB;AAAA;AAAA;AAAA,cAGKzB,QAAKd,GAAgBM,EAAA,CAAA;AAAA,eACpB,KAAK,kBAAkB;AAAA;AAAA,EAAA;AAAA,EAIrC,iBAAiB;AACZ,WAAC,KAAK,UAAU,SAIbiC,yCAA4C,KAAK,SAAS,KAAK,mBAAmB,CAAC;AAAA,KACvFC;AAAA,MACD,KAAK;AAAA,MACL,CAACC,MAASA,EAAK;AAAA,MACf,CAACA,MAAS;;AACF,eAAAF;AAAA;AAAA,gBAEI,MAAMzB,EAAA,MAAKd,GAALI,EAAA,EAAA,KAAA,MAAuBqC,EAAK,EAAG,CAAA;AAAA,kBACnC,MAAM;AAAA,QAAE,CAAA;AAAA,gCACInB,IAAA,KAAK,qBAAL,gBAAAA,EAAuB,QAAOmB,EAAK,KAAK,WAAW,EAAE;AAAA;AAAA;AAAA,oCAG/CA,EAAK,IAAI,cAAcrD,EAAA,MAAKS,CAAoB,CAAA;AAAA;AAAA,aAEvE4C,EAAK,IAAI;AAAA,aACTA,EAAK,8BAA8B,KAAK,SAAS,KAAK,kCAAkC,IAAI,EAAE;AAAA;AAAA;AAAA;AAAA,iBAI1F,CAACC,MAAiB5B,EAAA,MAAKd,GAALK,EAAA,EAAA,KAAA,MAAuBqC,GAAOD,EAAK,IAAI,CAACA,EAAK,cAAe,CAAA;AAAA,gBAC/EA,EAAK,iBACV,KAAK,SAAS,KAAK,+CAA+C,IAClE,KAAK,SAAS,KAAK,gDAAgD,CAAC;AAAA;AAAA;AAAA,MAAA;AAAA,IAG3E,CACA;AAAA,OA7BMF,sBAAyB,KAAK,SAAS,KAAK,mBAAmB,CAAC;AAAA,EA6BtE;AAAA;AAAA,EA0CH,wBAAwB;AACvB,WAAK,KAAK,mBAOHA;AAAA,uBACc,KAAK,oBAAoB;AAAA,MAC1CI,GAAW,KAAK,SAAS,KAAK,mBAAmB,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAM5B,KAAK,SAAS,KAAK,eAAe,CAAC;AAAA,6BACnC,KAAK,SAAS,KAAK,eAAe,CAAC;AAAA;AAAA,OAEzDH;AAAA,MACD,KAAK;AAAA,MACL,CAACC,MAASA,EAAK;AAAA,MACf,CAACA,MAAS;AACH,cAAAG,IAAO,KAAK,OAAO,KAAK,CAACnB,OAAMA,KAAA,gBAAAA,EAAG,WAAUgB,EAAK,KAAK;AACrD,eAAAF;AAAA;AAAA,2BAEaE,EAAK,KAAK;AAAA;AAAA,YAEzBG,IACCA,EAAK,KAAK;AAAA,UAAI,CAACC,MACfA,EAAK,QACFN,6BAAgCM,EAAK,KAAK,YAC1CA,EAAK,UACJN,+BAAkCM,EAAK,KAAK,YAC5CA,EAAK;AAAA,QAAA,IAETC,CAAO;AAAA;AAAA;AAAA;AAAA,MAAA;AAAA,IAKd,CAAA;AAAA;AAAA;AAAA,MAvCIP;AAAA;AAAA;AAAA;AAAA;AAAA,EAuCJ;AAAA,EAML,IAAI,uBAAuB;;AAC1B,WACC,KAAK,SAAS,OAAKjB,IAAA,KAAK,qBAAL,gBAAAA,EAAuB,SAAQ,oBAAI,KAAK,GAAGlC,EAAK,MAAAS,CAAA,CAAoB,IACvF,UACAkC,IAAA,KAAK,qBAAL,gBAAAA,EAAuB;AAAA,EAAA;AAAA,EAIhB,SAAS;AACV,WAAAQ;AAAA;AAAA;AAAA;AAAA,QAID,KAAK,mBAAmB,SACvBA;AAAA,+CACsC,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA,YACzE,KAAK,oBAAqB,CAAA;AAAA;AAAA,YAG7BO,CAAO;AAAA,QACR,KAAK,eAAgB,CAAA;AAAA;AAAA,OAEtB,KAAK,sBAAuB,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAMpB,KAAK,QAAQ;AAAA,cACd,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA;AAAA,eAInC,KAAK,UAAU;AAAA,cAChB,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA,kBAClC,CAAC,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA,EAAA;AAwHxC;AA9eCnD,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAEAC,IAAA,oBAAA,QAAA;AASAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAzCMC,IAAA,oBAAA,QAAA;AAgGNC,IAAc,WAAG;AAChB,QAAM8C,IAAiB3D,EAAA,MAAKW,CAA0B,KAAAX,EAAA,MAAKU,CAAsB,KAAA;AAC5E,OAAA,mBAAmB,KAAK,eAAe,OAAOiD;AACpD;AAEM7C,IAAgB,iBAAG;;AACpB,MAAA,GAACoB,IAAA,KAAK,oBAAL,QAAAA,EAAsB;AACpB,UAAA,IAAI,MAAM,4BAA4B;AAG7C,QAAM,EAAE,MAAAH,EAAA,IAAS,MAAM/B,QAAKO,CAAoB,EAAA;AAAA,KAC/CoC,IAAA,KAAK,oBAAL,gBAAAA,EAAsB;AAAA,IACtB,KAAK,oBAAoB;AAAA,EAC1B;AACA,MAAI,CAACZ,EAAM;AAEX,QAAM6B,IAA+B,CAAC,GAEhCC,IAAgB,CAAC,GAAG,IAAI,IAAI9B,KAAA,gBAAAA,EAAM,MAAM,IAAI,CAACsB,MAASA,EAAK,KAAK,GAAG,CAAC,GAEpE,EAAE,MAAMS,EAAU,IAAI,MAAM9D,EAAK,MAAAQ,CAAA,EAAoB,aAAaqD,CAAa;AAE/E,EAAA9B,KAAA,QAAAA,EAAA,MAAM,QAAQ,CAACsB,MAAc;;AAClC,IAAIA,EAAK,yBAETO,EAAU,KAAK;AAAA,MACd,MAAMP,EAAK;AAAA,MACX,QACCnB,IAAA4B,KAAA,gBAAAA,EAAW,KAAK,CAACC,MAASA,EAAK,WAAWV,EAAK,KAAK,QAApD,gBAAAnB,EAAyD,SAAQ,KAAK,SAAS,KAAK,qBAAqB;AAAA,MAC1G,6BAA6BmB,EAAK;AAAA,MAClC,IAAIA,EAAK;AAAA,MACT,gBAAgBA,EAAK;AAAA,IAAA,CACrB;AAAA,EAAA,IAGF,KAAK,YAAYO;AACjB,QAAM/D,KAAKqD,IAAAU,EAAU,KAAK,CAACP,MAASA,EAAK,2BAA2B,MAAzD,gBAAAH,EAA4D;AAEvE,EAAIrD,KACH6B,EAAA,MAAKd,MAAL,KAAoB,MAAAf,CAAA;AAEtB;AAEMkB,IAAc,eAAClB,GAAY;;AAC1B,QAAAmE,IAAU,KAAK,UAAU,KAAK,CAACX,MAASA,EAAK,OAAOxD,CAAE;AAE5D,MAAI,CAACmE,GAAS;AACb,SAAK,mBAAmB,QACxB,KAAK,SAAS,CAAC;AACf;AAAA,EAAA;AAGD,QAAM,EAAE,MAAAjC,EAAK,IAAI,MAAM/B,EAAK,MAAAO,CAAA,EAAoB,mBAAmBV,CAAE;AAErE,MAAI,CAACkC,GAAM;AACV,SAAK,mBAAmB,QACxB,KAAK,SAAS,CAAC;AACf;AAAA,EAAA;AAGD,OAAK,mBAAmB;AAAA,IACvB,MAAMiC,EAAQ;AAAA,IACd,MAAMA,EAAQ;AAAA,IACd,QAAM9B,IAAAH,EAAK,SAAS,KAAK,CAACM,MAAMA,EAAE,YAAY,KAAK,gBAAgB,MAA7D,gBAAAH,EAAgE,SAAQH,EAAK,SAAS,CAAC,EAAE;AAAA,IAC/F,IAAIA,EAAK;AAAA,IACT,YAAYA,EAAK,OACf,OAAO,CAACM,MAAMA,EAAE,YAAY,KAAK,oBAAoB,CAACA,EAAE,OAAO,EAC/D,IAAI,CAAC4B,OACE;AAAA,MACN,OAAOA,EAAM;AAAA,MACb,OAAOA,EAAM;AAAA,IACd,EACA;AAAA,EACH,GAEA,MAAMvC,QAAKd,GAALQ,EAAA,EAAA,KAAA,IAAA;AACP;AAsCAJ,KAAiB,SAACnB,GAAY;AAC7B6B,EAAAA,EAAA,MAAKd,MAAL,KAAoB,MAAAf,CAAA;AACrB;AAEAoB,KAAiB,SAACqC,GAAczD,GAAYM,GAAyB;AACpE,EAAAmD,EAAM,eAAe,GACrBA,EAAM,yBAAyB,GAC1BtD,EAAA,MAAAO,CAAA,EAAoB,kBAAkBV,GAAIM,CAAc;AAEvD,QAAA6D,IAAU,KAAK,UAAU,KAAK,CAACX,MAASA,EAAK,OAAOxD,CAAE;AAC5D,EAAKmE,MAELA,EAAQ,iBAAiB7D,GACzB,KAAK,cAAc,WAAW;AAC/B;AAEAe,KAAgB,SAACoC,GAAuB;AACjC,QAAAW,IAAQX,EAAM,OAAO;AAEtB,OAAA,mBAAmBW,EAAM,SAAS,GACvCvC,EAAA,MAAKd,GAALE,CAAA,EAAA,KAAA,IAAA;AACD;AAEAK,IAAW,SAAC+C,GAAqB;AACzB,SAAAA,EAAI,QAAQ,gBAAgB,EAAE;AACtC;AA+CM9C,KAAS,iBAAG;;AACb,MAAA,CAAC,KAAK,iBAAkB;AAEtB,QAAA+C,KAAwBjC,IAAA,KAAK,oBAAL,gBAAAA,EAAsB,OAAO;AAAA,IAC1D,CAACG,MAAMA,EAAE,YAAY,KAAK,oBAAoB,CAACA,EAAE;AAAA;AAGlD,MAAI,CAAC8B;AACE,UAAA,IAAI,MAAM,qCAAqC;AAGhD,QAAAC,KAAclB,KAAAP,IAAA,KAAK,oBAAL,gBAAAA,EAAsB,SAAS,KAAK,CAACN,MAAMA,EAAE,YAAY,KAAK,sBAA9D,gBAAAa,EAAiF;AAErG,MAAI,CAACkB;AACE,UAAA,IAAI,MAAM,yBAAyB;AAG1C,QAAMC,IAAyD,CAAC,GAE1DC,IAAWC,GAAUH,GAAa,KAAK,iBAAiB,IAAI;AAClE,EAAAC,EAAM,KAAK,EAAE,OAAO,QAAQ,MAAMC,GAAU,GAE5C,KAAK,iBAAiB,WAAW,QAAQ,CAACjB,MAAS;AAC5C,UAAAmB,IAAaL,EAAsB,KAAK,CAAC9B,MAAMA,EAAE,UAAUgB,EAAK,KAAK;AAE3E,QAAI,CAACmB,EAAY;AAEjB,UAAMC,IAAmB/C,EAAK,MAAAd,GAAAO,CAAA,EAAL,WAAiB,KAAK,UAAUqD,EAAW,KAAK,CAAA,GACnEE,IAAqBhD,EAAK,MAAAd,GAAAO,CAAA,EAAL,WAAiB,KAAK,UAAUkC,EAAK,KAAK,CAAA,GAE/DG,IAAOe,GAAUE,GAAkBC,CAAkB;AAC3D,IAAAL,EAAM,KAAK,EAAE,OAAOhB,EAAK,OAAO,MAAAG,GAAM;AAAA,EAAA,CACtC,GAEI,KAAA,SAAS,CAAC,GAAGa,CAAK;AACxB;AA7TYhD,EAwZI,SAAS;AAAA,EACxBsD;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+GD;AAvgBAC,EAAA;AAAA,EADCC,EAAM;AAAA,GADKzD,EAEZ,WAAA,aAAA,CAAA;AAGAwD,EAAA;AAAA,EADCC,EAAM;AAAA,GAJKzD,EAKZ,WAAA,oBAAA,CAAA;AAYAwD,EAAA;AAAA,EADCC,EAAM;AAAA,GAhBKzD,EAiBZ,WAAA,oBAAA,CAAA;AAGAwD,EAAA;AAAA,EADCC,EAAM;AAAA,GAnBKzD,EAoBZ,WAAA,gBAAA,CAAA;AAGAwD,EAAA;AAAA,EADCC,EAAM;AAAA,GAtBKzD,EAuBZ,WAAA,sBAAA,CAAA;AAGAwD,EAAA;AAAA,EADCC,EAAM;AAAA,GAzBKzD,EA0BZ,WAAA,UAAA,CAAA;AA1BYA,IAANwD,EAAA;AAAA,EADNE,EAAc,oBAAoB;AAAA,GACtB1D,CAAA;AC7DN,MAAM2D,KAAmB;AAAA,EAC9B,GAAG3D,EAAwB;AAAA;AAAA,EAC3BuD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmDF;;;;;;ACrCA,MAAMK,KAAgC;AAAA,EACpC,OAAO;AAAA,EACP,OAAO;AAAA,EACP,YAAY;AAAA,IACV,OAAO;AAAA,IACP,QAAQ;AAAA,EAAA;AAEZ;AAGa,IAAAC,IAAN,cAAuBC,GAAW;AAAA,EAAlC,cAAA;AAAA,UAAA,GAAA,SAAA,GAEL,KAAO,MAAM,IAGoB,KAAA,UAAAF;AAAA,EAAA;AAAA,EAKjC,oBAA0B;AACxB,UAAM,kBAAkB,GAEnB,KAAK,OACR,QAAQ,MAAM,+CAA+C,GAGxC,IAAI,eAAe,MAAM;AAC9C,WAAK,mBAAmB;AAAA,IAAA,CACzB,EACc,QAAQ,IAAI;AAAA,EAAA;AAAA,EAG7B,qBAAqB;AACnB,QAAIG,IAAQ,KAAK,cAAc,KAAK,QAAQ,WAAW;AAEvD,IAAIA,IAAQ,MACFA,IAAA,IAGL,KAAA,MAAM,YAAY,qBAAqB,GAAG,KAAK,QAAQ,WAAW,KAAK,IAAI,GAC3E,KAAA,MAAM,YAAY,sBAAsB,GAAG,KAAK,QAAQ,WAAW,MAAM,IAAI,GAClF,KAAK,MAAM,YAAY,qBAAqB,GAAGA,CAAK,EAAE,GACjD,KAAA,MAAM,YAAY,eAAe,GAAG,KAAK,QAAQ,WAAW,SAASA,CAAK,IAAI;AAAA,EAAA;AAAA,EAGrF,sBAAsB;AACf,SAAA,kBAAkB,GAAG,CAAC;AAAA,EAAA;AAAA,EAG7B,kBAAkBC,IAAoB,GAAGC,IAAoB,GAAG;;AACzD,KAAA3C,KAAAT,IAAA,KAAA,WAAA,gBAAAA,EAAQ,kBAAR,QAAAS,EAAuB,SAAS;AAAA,MACnC,KAAK0C;AAAA,MACL,MAAMC;AAAA,MACN,UAAU;AAAA,IAAA;AAAA,EACX;AAAA,EAGH,MAAM,qBAAqB;AACrB,QAAA,CAAC,KAAK,IAAK;AAET,UAAAC,IAAgB,GAAG,KAAK,GAAG;AAE7B,QAAA;AACI,YAAA,UAAU,UAAU,UAAUA,CAAa;AAAA,aAE1CC,GAAK;AACJ,cAAA,MAAM,oCAAoCA,CAAG;AAAA,IAAA;AAAA,EACvD;AAAA;AAAA,EAIF,eAAqB;AACnB,SAAK,mBAAmB;AAAA,EAAA;AAAA,EAGjB,SAAS;AACZ,WAAC,KAAK,MAIHrC;AAAA;AAAA;AAAA;AAAA,qBAIU,KAAK,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAQpB,KAAK,GAAG;AAAA;AAAA,QAfnB;AAAA,EAemB;AA8DhC;AAjJa+B,EAwFK,SAAS;AAAA,EACvBN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuDF;AA9IOC,EAAA;AAAA,EADNY,GAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GADfP,EAEJ,WAAA,OAAA,CAAA;AAGPL,EAAA;AAAA,EADCC,EAAM;AAAA,GAJII,EAKX,WAAA,WAAA,CAAA;AAGAL,EAAA;AAAA,EADCa,EAAM,QAAQ;AAAA,GAPJR,EAQX,WAAA,UAAA,CAAA;AARWA,IAANL,EAAA;AAAA,EADNE,EAAc,WAAW;AAAA,GACbG,CAAA;;;;;;;2YC7BbS,GAAAC,GAAAC,GAAAC,IAAAC,IAAAC,GAAAC;AAYa,IAAAC,IAAN,cAAqC7E,EAAwB;AAAA,EAUlE,cAAc;AACN,UAAA,GAXH3B,EAAA,MAAAmG,CAAA,GACmBnG,EAAA,MAAAiG,GAAA,EAAA,GACHjG,EAAA,MAAAkG,GAAA,EAAA,GAUnBlE,EAAA,MAAKmE,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA;AAAA,EAkHF,UAAgB;AAEd,eAAW,MAAM;AACf,MAAApE,EAAA,MAAKmE,GAALG,CAAA,EAAA,KAAA,IAAA;AAAA,OACC,GAAG;AAAA,EAAA;AAAA,EAGR,qCAAqC;;AACnC,WAAK,KAAK,mBAQH7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBASUnD,EAAA,MAAK4F,EAAU,KAAI1D,IAAA,KAAK,oBAAL,gBAAAA,EACtB,MAAM,YAAY,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAOrB,KAAK,oBAAoB;AAAA;AAAA;AAAA;AAAA,qBAIxClC,EAAK,MAAA4F,CAAA,CAAU,eAAcjD,IAAA,KAAK,oBAAL,gBAAAA,EAChC,MAAM,QAAQ,KAAK,iBAAiB,EAAE,YAAY,KACnD,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,QA9BpBQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA8BoB;AAAA,EAQtB,SAAS;AACT,WAAAA;AAAA;AAAA;AAAA,gBAGKnD,EAAA,MAAK2F,CAAe,IAAA,cAAc,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,mBAK7CjE,QAAKmE,GAAWE,EAAA,CAAA;AAAA;AAAA,kBAEjB/F,EAAA,MAAK2F,CAAe,IAAA,sBAAsB,iBAAiB;AAAA;AAAA;AAAA,YAGjE3F,EAAA,MAAK2F,CACH,IAAA,sBACA,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,cAKjB,KAAK,mBAAmB,SACtBxC;AAAA;AAAA;AAAA,+BAGe,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA;AAAA,sBAE/C,KAAK,oBAAqB,CAAA;AAAA;AAAA,oBAGhCO,CAAO;AAAA,cACT,KAAK,eAAgB,CAAA;AAAA;AAAA;AAAA,cAGrB1D,EAAA,MAAK2F,CACH,IAAAxC,KAAQ,KAAK,sBAAuB,CAAA,MACpCA,KAAQ,KAAK,mCAAoC,CAAA,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAO/C,KAAK,QAAQ;AAAA,oBACd,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,qBAKnC,KAAK,UAAU;AAAA,oBAChB,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA,wBAClC,CAAC,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,EAAA;AAQ9C;AAvOEwC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAFKC,IAAA,oBAAA,QAAA;AAeCC,KAAK,iBAAG;AAGP,EAAAlG,GAAA,MAAAgG,GAAa,OAAO,SAAS,MAAA;AACpC;AAEMG,KAAW,iBAAG;AACb,EAAAnG,GAAA,MAAA+F,GAAe,CAAC3F,EAAK,MAAA2F,CAAA,CAAA,GAC1B,KAAK,cAAc,GAEd3F,QAAK2F,CAAc,MACtB,MAAM,KAAK,gBACX,WAAW,MAAM;AACf,IAAAjE,EAAA,MAAKmE,GAALG,CAAA,EAAA,KAAA,IAAA;AAAA,KACD,GAAG;AAER;AAEAA,IAAgB,WAAG;AACjB,MAAI,CAAC,KAAK,yBAAyB,CAAC,KAAK,uBAAwB;AAEjE,QAAMG,IAAU,CAAC,KAAK,uBAAuB,KAAK,sBAAsB;AAEhE,EAAAA,EAAA,QAAQ,CAACC,MAAW;AAC1B,IAAIA,MAAW,SAEfA,EAAO,SAAS,MAAM;AACpB,MAAAA,EAAO,oBAAoB;AAAA,IAC7B;AAAA,EAAA,CACD;AAEK,QAAAC,IAAe,CAACC,MAAa;AACjC,UAAMC,IAAiBD,EAAE,eACnBE,IAAiBD,KAAA,gBAAAA,EAAgB,cACjCE,IAAeN,EAAQ;AAAA,MAC3B,CAAC9C,MAASA,EAAK,WAAWmD;AAAA,IAC1B,EAAA,IAAI,CAAQnD,MAAAA,EAAK,MAAM;AAEzB,IAAKmD,KAEQC,EAAA,QAAQ,CAACC,MAAgB;;AACpC,MAAKA,OACLxE,IAAAwE,EAAY,kBAAZ,QAAAxE,EAA2B;AAAA,QACzB;AAAA,QACAmE;AAAA,SAGG3E,EAAA,MAAAmE,GAAAI,EAAA,EAAL,WAAiBO,GAAgBE,CAAA,GAEjC,OAAO,sBAAsB,MAAM;;AACjC,SAAAxE,IAAAwE,KAAA,gBAAAA,EAAa,kBAAb,QAAAxE,EAA4B;AAAA,UAC1B;AAAA,UACAmE;AAAA;AAAA,MACF,CACD;AAAA,IAAA,CACF;AAAA,EACH;AAEQ,EAAAF,EAAA,QAAQ,CAACC,MAAW;;AAC1B,KAAAzD,KAAAT,IAAAkE,EAAO,WAAP,gBAAAlE,EAAe,kBAAf,QAAAS,EAA8B,iBAAiB,UAAU0D;AAAA,EAAY,CACtE;AACH;AAEAJ,KAAW,SACTO,GACAG,GACA;;AACI,MAAA,GAACH,KAAkB,CAACG;AAEpB,QAAA;AACF,YAAMC,IACJJ,EAAe,qBACftE,IAAAsE,EAAe,kBAAf,gBAAAtE,EAA8B,WAC1B2E,IACJF,EAAa,qBACbhE,IAAAgE,EAAa,kBAAb,gBAAAhE,EAA4B;AAE1B,UAAA,CAACiE,KAAe,CAACC,EAAW;AAG1B,YAAAC,IAAcF,EAAY,mBAAmBA,EAAY,MACzDG,IAAYF,EAAU,mBAAmBA,EAAU,MAEnDG,IAAeF,EAAY,eAAeA,EAAY,cACtDG,IACJD,IAAe,IAAIF,EAAY,YAAYE,IAAe,GAEtDE,IACJH,EAAU,eAAeA,EAAU,cAC/BI,IAAYF,IAAkBC,GAG9BE,KAAgBN,EAAY,cAAcA,EAAY,aACtDO,KACJD,KAAgB,IAAIN,EAAY,aAAaM,KAAgB,GAEzDE,KAAsBP,EAAU,cAAcA,EAAU,aACxDQ,KAAaF,KAAuBC;AAG1C,OAAApE,IAAAyD,EAAa,kBAAb,QAAAzD,EAA4B,SAAS;AAAA,QACnC,KAAKiE;AAAA,QACL,MAAMI;AAAA,QACN,UAAU;AAAA,MAAA;AAAA,aAELjB,GAAG;AACF,cAAA,MAAM,yBAAyBA,CAAC;AAAA,IAAA;AAE5C;AA3HWJ,EAuOK,SAASlB;AAlOzBH,EAAA;AAAA,EADCa,EAAM,wBAAwB;AAAA,GAJpBQ,EAKX,WAAA,yBAAA,CAAA;AAGArB,EAAA;AAAA,EADCa,EAAM,yBAAyB;AAAA,GAPrBQ,EAQX,WAAA,0BAAA,CAAA;AARWA,IAANrB,EAAA;AAAA,EADNE,EAAc,mBAAmB;AAAA,GACrBmB,CAAA;AA0Ob,MAAAsB,KAAetB;"}